/*
drop table identity.user_role;

drop table identity.role;

drop table identity.external_login;
drop table identity.user;
*/


-- http://www.npgsql.org/doc/types/datetime.html

-- create database asp_net_core_example;

create schema identity;


CREATE TABLE identity.user
(
    id INT generated by default as identity primary key,
    user_name text not null,
    normalized_user_name text not null,
    email text,
    normalized_email text null,
    email_confirmed boolean not null,
    password_hash text,
    phone_number text,
    phone_number_confirmed boolean not null,
    two_factor_enabled boolean not null,

    security_stamp text,
    concurrency_stamp text,

    lockout_end time with time zone,
    lockout_enabled boolean not null default false,
    access_failed_count int not null default 0
);

CREATE INDEX ix_identity_user__normalized_user_name ON identity.user (normalized_user_name);


CREATE INDEX ix_identity_user__normalized_email ON identity.user (normalized_email);


CREATE TABLE identity.role
(
    id int generated by default as identity primary key,
    name text not null,
    normalized_name text not null,

    concurrency_stamp text
);
CREATE INDEX ix_identity_role__normalized_name ON identity.role (normalized_name);


CREATE TABLE identity.user_role
(
    user_id int not null,
    role_id int not null,
    primary key (user_id, role_id),

    constraint fk_identity_user_role__user foreign key (user_id) references identity.user(id),
    constraint fk_identity_user_role__role foreign key (role_id) references identity.role(id)
);




CREATE TABLE identity.external_login
(
    id int generated by default as identity primary key, 
    user_id int not null, 
    login_provider text not null, 
    provider_key text not null, 
    display_name text not null,

    constraint fk_identity_external_login__user foreign key (user_id) references identity.user(id)
);



